(()=>{"use strict";var t={d:(o,e)=>{for(var i in e)t.o(e,i)&&!t.o(o,i)&&Object.defineProperty(o,i,{enumerable:!0,get:e[i]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},o={};t.r(o),t.d(o,{geoLineDistance:()=>y,geoToMapDistance:()=>z,getCenterZoomByPoints:()=>H,getMetersFromPixels:()=>F,getMousePositionInContainer:()=>D,projectGeoToMap:()=>g,projectGeoToScreen:()=>G,projectMapToGeo:()=>P,projectMapToScreen:()=>B,projectScreenToGeo:()=>R});const e=1e-6;let i="undefined"!=typeof Float64Array?Float64Array:Array;Math.random;Math.PI;function n(){let t=new i(3);return t[0]=0,t[1]=0,t[2]=0,t}function r(t,o,e){let n=new i(3);return n[0]=t,n[1]=o,n[2]=e,n}function a(t,o){let e=o[0],i=o[1],n=o[2],r=e*e+i*i+n*n;return r>0&&(r=1/Math.sqrt(r),t[0]=o[0]*r,t[1]=o[1]*r,t[2]=o[2]*r),t}const s=function(t,o,e){return t[0]=o[0]-e[0],t[1]=o[1]-e[1],t[2]=o[2]-e[2],t};!function(){let t=n()}();function c(t,o,e){let i=o[0],n=o[1],r=o[2],a=o[3],s=o[4],c=o[5],h=o[6],u=o[7],p=o[8],f=o[9],M=o[10],l=o[11],m=o[12],x=o[13],w=o[14],d=o[15],j=e[0],g=e[1],P=e[2],v=e[3];return t[0]=j*i+g*s+P*p+v*m,t[1]=j*n+g*c+P*f+v*x,t[2]=j*r+g*h+P*M+v*w,t[3]=j*a+g*u+P*l+v*d,j=e[4],g=e[5],P=e[6],v=e[7],t[4]=j*i+g*s+P*p+v*m,t[5]=j*n+g*c+P*f+v*x,t[6]=j*r+g*h+P*M+v*w,t[7]=j*a+g*u+P*l+v*d,j=e[8],g=e[9],P=e[10],v=e[11],t[8]=j*i+g*s+P*p+v*m,t[9]=j*n+g*c+P*f+v*x,t[10]=j*r+g*h+P*M+v*w,t[11]=j*a+g*u+P*l+v*d,j=e[12],g=e[13],P=e[14],v=e[15],t[12]=j*i+g*s+P*p+v*m,t[13]=j*n+g*c+P*f+v*x,t[14]=j*r+g*h+P*M+v*w,t[15]=j*a+g*u+P*l+v*d,t}function h(t,o,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=o[0],t[13]=o[1],t[14]=o[2],t[15]=1,t}const u={fov:60,near:1e3,far:Math.pow(2,34),minCalculationScreenHeight:1e3,viewportLimitRatio:2,perspectiveDistanceLimitRatio:10};function p(){let t=new i(2);return t[0]=0,t[1]=0,t}function f(t,o){let e=new i(2);return e[0]=t,e[1]=o,e}!function(){let t=p()}();const M=256,l=Math.pow(2,32);Math.pow(2,20),Math.pow(2,15),Math.pow(2,16);function m(t,o){return{min:t||f(1/0,1/0),max:o||f(-1/0,-1/0)}}function x(t,o){var e,i,n;e=t.min,i=t.min,n=o,e[0]=Math.min(i[0],n[0]),e[1]=Math.min(i[1],n[1]),function(t,o,e){t[0]=Math.max(o[0],e[0]),t[1]=Math.max(o[1],e[1])}(t.max,t.max,o)}function w(t,o){return t[0]=o.min[0]+(o.max[0]-o.min[0])/2,t[1]=o.min[1]+(o.max[1]-o.min[1])/2,t}const d=2*Math.PI*6378137,j=l/d;h([],[-1,-1,0],[2,2,1]),h([],[.5,.5,0],[.5,.5,1]);function g(t){const o=l/2,e=Math.sin(V(t[1])),i=t[0]*l/360,n=Math.log((1+e)/(1-e))*l/(4*Math.PI);return r(L(i,-o,o),L(n,-o,o),0)}function P(t){const o=[0,0];o[0]=360*t[0]/l;const e=-2*Math.PI/l;return o[1]=90-2*(Math.atan(Math.exp(t[1]*e))/Math.PI*180),o}function v(t){return Math.max(t,u.minCalculationScreenHeight)}function z(t,o){return o*j*(e=t[1],1/Math.cos(V(e)));var e}function b(t,o){const e=Math.PI/180,i=t[1]*e,n=o[1]*e,r=Math.sin((o[1]-t[1])*e/2),a=Math.sin((o[0]-t[0])*e/2),s=r*r+Math.cos(i)*Math.cos(n)*a*a,c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371e3*c)}function y(t){let o=0;if(t.length>1)for(let e=0;e<t.length-1;e++)o+=b(t[e],t[e+1]);return o}m([-l/2,-l/2],[l/2,l/2]);function O(t,o){return 0===t?-1/0:-Math.log(o*M/(t*l))/Math.LN2}p(),p();const S=[0,0,1],I=n(),T=n();class q{constructor(t){this.state=t,this.position=[0,0,0],this.projectionMatrix=[],this.viewMatrix=[],this.viewProjectionMatrix=[],this.viewProjectionMatrixInverse=[],this.horizonPixelOffset=0,this.horizonPixelOffset=0,this.update()}setState(t){this.state=t,this.update()}update(){this.updatePosition(),this.updateProjectionMatrix(),this.updateViewMatrix(),c(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),function(t,o){let e=o[0],i=o[1],n=o[2],r=o[3],a=o[4],s=o[5],c=o[6],h=o[7],u=o[8],p=o[9],f=o[10],M=o[11],l=o[12],m=o[13],x=o[14],w=o[15],d=e*s-i*a,j=e*c-n*a,g=e*h-r*a,P=i*c-n*s,v=i*h-r*s,z=n*h-r*c,b=u*m-p*l,y=u*x-f*l,O=u*w-M*l,S=p*x-f*m,I=p*w-M*m,T=f*w-M*x,q=d*T-j*I+g*S+P*O-v*y+z*b;q&&(q=1/q,t[0]=(s*T-c*I+h*S)*q,t[1]=(n*I-i*T-r*S)*q,t[2]=(m*z-x*v+w*P)*q,t[3]=(f*v-p*z-M*P)*q,t[4]=(c*O-a*T-h*y)*q,t[5]=(e*T-n*O+r*y)*q,t[6]=(x*g-l*z-w*j)*q,t[7]=(u*z-f*g+M*j)*q,t[8]=(a*I-s*O+h*b)*q,t[9]=(i*O-e*I-r*b)*q,t[10]=(l*v-m*g+w*d)*q,t[11]=(p*g-u*v-M*d)*q,t[12]=(s*y-a*S-c*b)*q,t[13]=(e*S-i*y+n*b)*q,t[14]=(m*j-l*P-x*d)*q,t[15]=(u*P-p*j+f*d)*q)}(this.viewProjectionMatrixInverse,this.viewProjectionMatrix),this.updateHorizonPixelOffset()}putProject(t,o){const{size:e,viewport:i}=this.state,n=this.viewProjectionMatrix,r=o[0],a=o[1],s=o[2],c=e[0]/2,h=e[1]/2,u=n[3]*r+n[7]*a+n[11]*s+n[15];t[0]=c+i.left+(n[0]*r+n[4]*a+n[12])*c/u,t[1]=h+i.top-(n[1]*r+n[5]*a+n[9]*s+n[13])*h/u}project(t){const o=[0,0,0];return this.putProject(o,t),o}unproject(t){const{size:o,viewport:e}=this.state,i=[(t[0]-e.left)/o[0]*2-1,-(Math.max(this.horizonPixelOffset,t[1])-e.top)/o[1]*2+1,0];!function(t,o,e){let i=o[0],n=o[1],r=o[2],a=e[3]*i+e[7]*n+e[11]*r+e[15];a=a||1,t[0]=(e[0]*i+e[4]*n+e[8]*r+e[12])/a,t[1]=(e[1]*i+e[5]*n+e[9]*r+e[13])/a,t[2]=(e[2]*i+e[6]*n+e[10]*r+e[14])/a}(i,i,this.viewProjectionMatrixInverse),i[0]-=this.position[0],i[1]-=this.position[1],i[2]-=this.position[2],a(i,i);const n=-this.position[2]/i[2];return i[0]=this.position[0]+i[0]*n,i[1]=this.position[1]+i[1]*n,i[2]=this.position[2]+i[2]*n,i}getViewportVertices(){const{size:t,viewport:o}=this.state;return[this.unproject([o.left,t[1]+o.top,0]),this.unproject([t[0]+o.left,t[1]+o.top,0]),this.unproject([t[0]+o.left,o.top,0]),this.unproject([o.left,o.top,0])]}getHorizonPixelOffset(){return this.horizonPixelOffset}updatePosition(){const{center:t,rotation:o,zoom:e,pitch:i,size:n}=this.state,r=function(t,o){return v(o[1])*l/(512*Math.tan(V(u.fov)/2)*Math.pow(2,t))}(e,n),a=Math.max(r*Math.sin(i),1);this.position[0]=t[0]+Math.sin(o)*a,this.position[1]=t[1]-Math.cos(o)*a,this.position[2]=r*Math.cos(i)}updateViewMatrix(){!function(t,o,i,n){let r,a,s,c,h,u,p,f,M,l,m=o[0],x=o[1],w=o[2],d=n[0],j=n[1],g=n[2],P=i[0],v=i[1],z=i[2];Math.abs(m-P)<e&&Math.abs(x-v)<e&&Math.abs(w-z)<e?mat4.identity(t):(p=m-P,f=x-v,M=w-z,l=1/Math.sqrt(p*p+f*f+M*M),p*=l,f*=l,M*=l,r=j*M-g*f,a=g*p-d*M,s=d*f-j*p,l=Math.sqrt(r*r+a*a+s*s),l?(l=1/l,r*=l,a*=l,s*=l):(r=0,a=0,s=0),c=f*s-M*a,h=M*r-p*s,u=p*a-f*r,l=Math.sqrt(c*c+h*h+u*u),l?(l=1/l,c*=l,h*=l,u*=l):(c=0,h=0,u=0),t[0]=r,t[1]=c,t[2]=p,t[3]=0,t[4]=a,t[5]=h,t[6]=f,t[7]=0,t[8]=s,t[9]=u,t[10]=M,t[11]=0,t[12]=-(r*m+a*x+s*w),t[13]=-(c*m+h*x+u*w),t[14]=-(p*m+f*x+M*w),t[15]=1)}(this.viewMatrix,this.position,this.state.center,S)}updateProjectionMatrix(){const{fov:t,near:o,far:e}=u,{size:i,view:n}=this.correctViewAndSize(),r=i[0]/i[1];let a=o*Math.tan(V(t)/2),s=2*a,c=r*s,h=-c/2;n&&(h+=n.x*c/i[0],a-=n.y*s/i[1],c*=n.width/i[0],s*=n.height/i[1]);const p=h+c,f=a-s,M=this.projectionMatrix;M[0]=2*o/(p-h),M[5]=2*o/(a-f),M[8]=(p+h)/(p-h),M[9]=(a+f)/(a-f),M[10]=-(e+o)/(e-o),M[11]=-1,M[14]=-2*e*o/(e-o),M[1]=M[2]=M[3]=M[4]=M[6]=M[7]=M[12]=M[13]=M[15]=0}correctViewAndSize(){const{size:t,pitch:o,padding:e}=this.state,i=Math.max(0,e.top-e.bottom)*Math.tan(o),n=v(t[1])+i,r={x:(e.right-e.left)/2,y:(e.bottom-e.top)/2,width:t[0],height:t[1]};r.y+=(n-t[1])/2;return{view:r,size:[t[0],n]}}updateHorizonPixelOffset(){const{viewport:t,size:o,zoom:e}=this.state,i=this.unproject([t.left,o[1]+t.top,0]),n=this.unproject([t.left+o[0]/2,o[1]+t.top,0]),r=this.unproject([o[0]+t.left,o[1]+t.top,0]);s(T,r,i),function(t,o,e,i){let n=[],r=[];n[0]=o[0]-e[0],n[1]=o[1]-e[1],n[2]=o[2]-e[2],r[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),r[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),r[2]=n[2],t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2]}(T,T,I,V(90)),a(T,T);const c=function(t,o){return t*Math.pow(2,-o)*l/M}(o[1]*u.perspectiveDistanceLimitRatio,e);var h,p,f;p=T,f=c,(h=T)[0]=p[0]*f,h[1]=p[1]*f,h[2]=p[2]*f,function(t,o,e){t[0]=o[0]+e[0],t[1]=o[1]+e[1],t[2]=o[2]+e[2]}(T,n,T),this.putProject(T,T),this.horizonPixelOffset=Math.max(0,Math.ceil(T[1]))}}function L(t,o,e){return t=Math.max(t,o),t=Math.min(t,e)}function V(t){return t*Math.PI/180}function A(t,o){const e=Math.sin(o),i=Math.cos(o);!function(t,o,e){t[0]=o,t[1]=e}(t,i*t[0]-e*t[1],e*t[0]+i*t[1])}function C(t,o){return Math.min(O(o[0],Math.abs(t.max[0]-t.min[0])),O(o[1],Math.abs(t.max[1]-t.min[1])))}function H(t,o,e){const i=function(t,o,e){if(0===t.length)return;const i=V(o),r=m();for(const o of t){const t=g(o);A(t,-i),x(r,t)}const a=n();return w(a,r),A(a,i),{center:a,zoom:C(r,e)}}(t,o,e);if(i)return{zoom:i.zoom,center:P(i.center)}}function D(t,o,e){const i=t.getBoundingClientRect();return[o-i.left-t.clientLeft,e-i.top-t.clientTop]}function G(t,o,e,i,n,r,a={top:0,right:0,bottom:0,left:0},s={top:0,right:0,bottom:0,left:0}){return new q({center:g(t),zoom:o,rotation:V(e),size:i,pitch:V(n),viewport:a,padding:s}).project(g(r))}function R(t,o,e,i,n,r,a={top:0,right:0,bottom:0,left:0},s={top:0,right:0,bottom:0,left:0}){return P(new q({center:g(t),zoom:o,rotation:V(e),size:i,pitch:V(n),viewport:a,padding:s}).unproject(r))}function F(t,o,e,i,n,r,a={top:0,right:0,bottom:0,left:0},s={top:0,right:0,bottom:0,left:0},c){return function(t,o,e,i,n,r,a={top:0,right:0,bottom:0,left:0},s={top:0,right:0,bottom:0,left:0},c,h){const u=new q({center:g(t),zoom:o,rotation:V(e),size:i,pitch:V(n),viewport:a,padding:s}),p=P(u.unproject(r)),f=P(u.unproject([r[0]+c,r[1]+h]));return Math.max(1,b(p,f))}(t,o,e,i,n,r,a,s,c,c)}function B(t,o){return new q(t).project(o)}module.exports=o})();